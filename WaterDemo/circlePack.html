<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>

html, body{
    color: whitesmoke;
}

</style>

<script src="//d3js.org/d3.v3.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.3/nv.d3.min.js"></script>
<style src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.3/nv.d3.min.css"></style> -->
<script src="https://d3js.org/d3-time.v1.min.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>
</head>
<body>
<script>

var width = 1000,
    height = 1000;

var svg = d3.select("body").append("svg")
    .attr({
        width : width,
        height : height
    });

var diameter = 960,
    format = d3.format(",d");

    var color = d3.scale.ordinal()
        .domain([0, 300])
        .range(['#d7191c','#fdae61','#ffffbf','#a6d96a','#1a9641']);;

var bubble = d3.layout.pack()
    .sort(comparator)
    .size([diameter, diameter])
    .padding(3.5)
    .value(function(d){return d.popTotal});

    var plot = svg.append("g")
        .attr({
            width : width - 100,
            height : height - 100
        }).attr("transform", "translate(" + 100 + "," + (50) + ")");

        // var x = d3.scale.ordinal()
        // .range([0, width], .1);
        //
        //   var y = d3.scale.linear()
        //       .range([height, 0]);
        //
        //   var color = d3.scale.category10();
        //
        //   var xAxis = d3.svg.axis()
        //       .scale(x)
        //       .orient("bottom");
        //
        //   var yAxis = d3.svg.axis()
        //       .scale(y)
        //       .orient("left");


    var center = [500,500];

var format = d3.timeFormat("%b_%Y")

// var color = d3.scale.category10();

d3.csv("WaterWithPop.csv",
accessor
, function(error, data) {
    if (error) throw error;
    console.log(data);
    //
    // var zips = d3.nest()
    //         .key(function(d) {return d["Location 1"]})
    //         .entries(data);

//
// console.log(zips);
var nodes = bubble.nodes({children:data}).filter(function(d) { return !d.children; });
console.log(nodes);
        var node = svg.selectAll(".node")
      .data(nodes)
    .enter().append("g")
      .attr("class", "node")
    //   .on('mouseover', tip.show)
    //           .on('mouseout', tip.hide)
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });


  node.append("title")
      .text(function(d) { return d.loc + ": " + d.sum; });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return color(d.sum); });

  node.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.loc; });

      d3.select("body").append("text")
         .attr("class", "label")
         .attr("transform", "translate(0,900)")
         .attr("y", 1)
         .attr("dy", "5.71em")
         .style("text-anchor", "start")
         .text("The Rate at Which Kids Drop PrimarySchool is equal to Size of Bubble")





});

function accessor(d){
        var row = {};
        row.sum = 0;
        row.popTotal = +d["Total"]
        row.loc = d["zip"]
        row.sum += (+d["5/6"]) + (+d["6/7"]) + (+d["7/8"]) + (+d["8/9"])
                    + (+d["9/10"]) + (+d["10/11"]) + (+d["11/12"]);
        return row;
}

function comparator(a, b) {
  return a.popTotal - b.popTotal;
}

</script>
</body>
