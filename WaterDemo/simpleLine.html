<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<style>

html, body{
    background-color: whitesmoke;
    font-family: 'Open Sans',sans-serif;
}

svg {
    background-color: whitesmoke;
    border-radius:5px;
}


.y_axis,
.axis {
  font: 10px sans-serif;
}

path.line {
    fill: none;
    stroke: darkblue;
    stroke-width: 4px;
}

.y_axis path,
.axis path {
    fill: none;
}


.axis line {
  fill: none;
  stroke: lightgrey;
  shape-rendering: crispEdges;
}

.y-axis line {
  stroke: lightgrey;
}

div#title {
    margin-left: 150px;
}

</style>

<script src="//d3js.org/d3.v3.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.3/nv.d3.min.js"></script>
<style src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.3/nv.d3.min.css"></style> -->
<!-- <script src="https://d3js.org/d3-time.v1.min.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script> -->
</head>
<body>
    <div id="title">
        <h2> Total Water Usage from 2005-2012 </h2>
        <h4></h4>
    </div>
<script>

var width = 600,
    height = 350;

var svg = d3.select("body").append("svg")
    .attr({
        width : width,
        height : height
    });




var plotHeight = height - 30,
    plotWidth = width - 150

    var plot = svg.append("g")
        .attr({
            width : plotWidth,
            height : plotWidth
        })
        .attr("transform", "translate(" + 130 + "," + 10 + ")");

        var x = d3.time.scale()
        .range([0, plotWidth]);

          var y = d3.scale.linear()
              .range([plotHeight, 0]);

        //   var color = d3.scale.category10();
        //
          var xAxis = d3.svg.axis()
              .scale(x)
              .orient("bottom");


          var yAxis = d3.svg.axis()
              .scale(y)
              .orient("left")
            .tickSize(-plotWidth);


              var line = d3.svg.line()
                .interpolate("linear")
                  .x(function(d) { return x(d.month); })
                  .y(function(d) { return y(d.total); });



// var color = d3.scale.category10();

d3.csv("monthTotal.csv", accessor, function(error, data) {
    if (error) throw error;
    console.log(data);

// var months = data.map(function(d){return d.month});
var months = d3.extent(data, function(d) { return d.month; });


// years = years.slice(0,years.length-1);
console.log(months)
    x.domain(months);

var totals = d3.extent(data, function(d) { return d.total; });
    console.log(totals)
totals[0] = totals[0] - 2000;
totals[1] = totals[1] + 2000;

    y.domain(totals);

//data.sort(comparator);

    // var zips = d3.nest()
    //         .key(function(d) {return d["Location 1"]})
    //         .entries(data);


    plot.append("g")
      .attr("class", "x_axis")
      .attr("class", "axis")
      .attr("transform", "translate(0," + plotHeight + ")")
      .call(xAxis)
    //   .append("text")
    //     // .attr("transform", "rotate(-90)")
    //     .attr("y", 6)
    //     .attr("dy", ".71em")
    //     .style("text-anchor", "end")
    //     .text("Percentage of Water Use (%)");

  plot.append("g")
      .attr("class", "y_axis")
      .call(yAxis);


d3.selectAll(".x_axis text")
    .attr("transform","rotate(-25)");



    var node = plot.append("path")
      .datum(data)
    .attr("class","line")
    .attr("d",line);
    //   .style("fill", function(d) { return color(d.sum); });





});

function accessor(d) {
    var format = d3.time.format("%b_%Y");
    d.total = (+d.total)
    d.month = format.parse(d.month)
    return d;
}

// function totaLaccessor(d){
//         var row = {};
//         row.sum = 0;
//         row.popTotal = +d["Total"]
//         row.loc = d["zip"]
//         row.sum += (+d["FY 5/6"]) + (+d["FY 6/7"]) + (+d["FY 7/8"]) + (+d["FY 8/9"])
//                     + (+d["FY 9/10"]) + (+d["FY 10/11"]) + (+d["FY 11/12"]) (+d["FY 12/13"]);
//         return row;
// }

function comparator(a, b) {
  return b.value - a.value;
}

</script>

</body>
<h4> Majority of water use is residential mainly focusing on Single-Family homes.
    Despite better water usage over time, more affluent home owners still are using unacceptably inproportionate amounts of water.
<h6> *data supplied by performance.lacity.org </h6>
